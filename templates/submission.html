<!DOCTYPE html>
<html lang="en">
  <head>
    <title>SMP Challenge</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <link rel="stylesheet" href="/static/css/bootstrap.css">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/sprintf.js"></script>
    <script src="/static/js/md5.js"></script>
    <style type="text/css">
      #nav-first {
        border-radius: 0px;
        margin-bottom: 0px;
        min-height: 80px;
      }

      #nav-second {
        border-radius: 0px;
        margin-bottom: 0px;
        top: 80px;
      }

      #nav-first-main {
        margin: 0 0;
        height: 80px;
      }

      #nav-first-main>li {
        height: 80px;
      }
      #nav-first-main>li>a {
        height: 80px;
        padding-top: 0;
        padding-bottom: 0;
        line-height: 80px;
      }

      #nav-second-main {
        margin: 0 80px;
      }

      .nav-second-li {
        font-size: 120%;
      }

      #block1 {
        background-color: white;
      }

      #block2 {
        background-color: #e8e8e8;
      }

      #block3 {
        background-color: white;
      }

      #block4 {
        background-color: #e8e8e8;
      }

      #block5 {
        background-color: white;
      }

      #block6 {
        background-color: #e8e8e8;
      }

      #block7 {
        background-color: #080808;
        position: absolute;
        bottom: 0;
        width: 100%;
      }

      .p-body{
        text-align: justify;
        font-family: "Arial", sans-serif;
        font-size: 120%;
      }

      h1,h2{
        font-family: "Arial", serif;
        /*font-size: 150%;*/
      }

      .timeline-li {
        font-family: "Arial", sans-serif;
        font-size: 120%;
      }

      #logo {
        padding-left:100px;
        padding-top: 10px;
      }

      .thumbnail {
        border-color: transparent;
        background-color: transparent;
      }

      .avatar {
        border-radius: 50%;
      }

      .nav-li {
        font-size: 120%;
      }

      td,th {
        text-align: center;
      }

      .orange {
        color: rgb(241,156,55) !important;
      }

      .help-block {
        display: none;
      }

      .member-title {
        padding-top: 10px;
      }

      .p-title {
        color: rgb(241,156,55) !important;
      }

      .container-fluid {
        padding-top: 130px;
      }

      #forget {
        cursor: pointer;
      }

      .team-display {
        display: none;
      }

      .no-team-display {
        display: none;
      }

    </style>
    <script type="text/javascript">
      $(document).ready(function(){

        $("#logout").click(function(e) {
          e.preventDefault();
          $.post("/logout", function(data, status) {
            window.location.href = "/";
          })
        });

        $("#editteam").click(function(e) {
          e.preventDefault();
          $("#modal-team").modal("show");
        });

        $(".submit-edit").click(function(e) {
          e.preventDefault();
          $("#modal-team").modal("show");
        });

var nownum = 1;
        $("#addmember").click(function(e) {
          e.preventDefault();
          if (nownum == 8) {
            alert("no more than 8 members");
            return;
          }
          var html = '<div class="row">\
                  <div class="col-xs-2">\
                    <label class="member-title" id="member%d-title">Member %d</label>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label id="member%d-name-label" for="member%d-name" class="sr-only"></label>\
                      <input type="text" class="form-control team-input" id="member%d-name">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label id="member%d-email-label" for="member%d-email" class="sr-only"></label>\
                      <input type="email" class="form-control team-input" id="member%d-email">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label id="member%d-organization-label" for="member%d-organization" class="sr-only"></label>\
                      <input type="text" class="form-control team-input" id="member%d-organization">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-1">\
                    <button class="btn btn-danger delete-member" id="delete-member%d" deleteid="%d"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>\
                  </div>\
                </div>';

          $("#team-form").append(sprintf(html, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum, nownum));
          nownum += 1;
        });

        $(document).on("click", ".delete-member", function(e) {
          e.preventDefault();
          $(this).parent().parent().remove();
          var deleteid = parseInt($(this).attr("deleteid"));
          for (var i = deleteid + 1; i <= nownum; i++) {
            $(sprintf("#member%d-title", i)).text(sprintf("Member %d", i - 1)).attr("id", sprintf("member%d-title", i - 1));
            $(sprintf("#delete-member%d", i)).attr("id", sprintf("delete-member%d", i - 1)).attr("deleteid", sprintf("%d", i - 1));

            $(sprintf("#member%d-name-label", i)).attr("for", sprintf("member%d-name", i-1)).attr("id", sprintf("member%d-name-label", i - 1));
            $(sprintf("#member%d-email-label", i)).attr("for", sprintf("member%d-email", i-1)).attr("id", sprintf("member%d-email-label", i - 1));
            $(sprintf("#member%d-organization-label", i)).attr("for", sprintf("member%d-organization", i-1)).attr("id", sprintf("member%d-organization-label", i - 1));

            $(sprintf("#member%d-name", i)).attr("id", sprintf("member%d-name", i - 1));
            $(sprintf("#member%d-email", i)).attr("id", sprintf("member%d-email", i - 1));
            $(sprintf("#member%d-organization", i)).attr("id", sprintf("member%d-organization", i - 1));

          }

          nownum -= 1;
        });

        $("#save").click(function(e) {
          e.preventDefault();

          var team_input = $(".team-input");
          var flag=true;
          for (var i = 0; i < team_input.length; i++) {
            if ($(team_input[i]).val() == "") {
              $(team_input[i]).parent().find("span").show().text("can not be empty");
              $(team_input[i]).parent().addClass("has-error");
              flag=false;
            }
          }
          if (flag == false) {
            return;
          }

          var data = {
            'teamname': $("#team-name").val(),
            'caption-name': $("#caption-name").val(),
            'caption-email': $("#caption-email").val(),
            'caption-organization': $("#caption-organization").val(),
            'member-num': nownum
          }

          for (var i = 1; i < nownum; i++) {
            data[sprintf("member%d-name", i)] = $(sprintf("#member%d-name", i)).val();
            data[sprintf("member%d-email", i)] = $(sprintf("#member%d-email", i)).val();
            data[sprintf("member%d-organization", i)] = $(sprintf("#member%d-organization", i)).val();
          }

          $.post("/update_team", data, function(data, status) {
            if (data.code == "00000") {
              alert("update success");
              $("#modal-team").modal("hide");
              window.location.reload();
            }
            else if (data.code == "10009") {
              $("#team-name").parent().addClass("has-error");
              $("#team-name").parent().find("span").text("team name exists").show();
            }
          });

        });

        $.getJSON("/get_team", function(data, status) {
          if (data.code == "00000") {
            $("#team-name").val(data.teamname);
            $("#caption-name").val(data.members[0].name);
            $("#caption-email").val(data.members[0].email);
            $("#caption-organization").val(data.members[0].organization);
            nownum = data.members.length;
            for (var i = 1; i < nownum; i++) {
              var html = '<div class="row">\
                  <div class="col-xs-2">\
                    <label class="member-title" id="member%d-title">Member %d</label>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label for="member%d-name" class="sr-only"></label>\
                      <input type="text" class="form-control team-input" id="member%d-name">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label for="member%d-email" class="sr-only"></label>\
                      <input type="email" class="form-control team-input" id="member%d-email">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-3">\
                    <div class="form-group">\
                      <label for="member%d-organization" class="sr-only"></label>\
                      <input type="text" class="form-control team-input" id="member%d-organization">\
                      <span class="help-block"></span>\
                    </div>\
                  </div>\
                  <div class="col-xs-1">\
                    <button class="btn btn-danger delete-member" id="delete-member%d" deleteid="%d"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>\
                  </div>\
                </div>';

              $("#team-form").append(sprintf(html, i, i, i, i, i, i, i, i, i, i));
              $(sprintf("#member%d-name", i)).val(data.members[i].name);
              $(sprintf("#member%d-email", i)).val(data.members[i].email);
              $(sprintf("#member%d-organization", i)).val(data.members[i].organization);
            }

            if (data.teamname != "" && nownum != 0) {
              $("#submit-teamname").text(data.teamname);
              $(".team-display").show();
            }
            else {
              $(".no-team-display").show();
            }
            
          }
          else {
            $(".no-team-display").show();
          }
        });

        // $("#submit-upload-btn").click(function() {
        //   $("#submit-upload-real").click();
        // });

        // $("#submit-upload-real").change(function() {
        //   var name = this.files[0].name;
        //   var size = parseInt(this.files[0].size);
        //   var d = "B";
        //   if (size > 1024) {
        //     size = size * 1.0 / 1024;
        //     d = "KB";
        //   }
        //   if (size > 1024) {
        //     size = size * 1.0 / 1024;
        //     d = "MB";
        //   }
        //   $("#submit-progress").find(".progress-bar").removeClass("progress-bar-success").attr("style","min-width:2em;width:0%").attr("aria-valuenow", "0").text("0%");
        //   $("#submit-progress").show();

        //   $("#submit-upload-btn").addClass("disabled");

        //   var files = this.files;
        //   var len = files.length;
        //   var fd = new FormData();
        //   fd.append('file', files[0]);
        //   $.ajax({
        //     url: "/submit",
        //     type: "POST",
        //     data: fd,
        //     processData: false,
        //     contentType: false,
        //     xhr: function() {
        //       var xhrobj = $.ajaxSettings.xhr();
        //       if (xhrobj.upload) {
        //         xhrobj.upload.addEventListener("progress", function(event) {
        //           var percent = 0;
        //           var position = event.loaded || event.position;
        //           var total = event.total || event.totalSize;
        //           if (event.lengthComputable) {
        //             percent = Math.ceil(position * 1.0 / total * 100);
        //           }
        //           $("#submit-progress").find(".progress-bar").attr("style",sprintf("min-width:2em;width:%d%%", percent)).attr("aria-valuenow", sprintf("%d", percent)).text(sprintf("%d%%", percent));
        //         })
        //       }
        //       return xhrobj;
        //     },
        //     success: function() {
        //       $("#submit-progress>.progress-bar").addClass("progress-bar-success");
        //       $("#submit-progress").hide();
        //       $("#submit-upload-btn").removeClass("disabled");
        //       window.location.reload();
        //     }
        //   })
        // });

        $.getJSON("/get_submit", function(data, status) {
          if (data.submission != "") {
            $("#latest-submission").html('<a href="/mysubmission/' + data.submission + '">' + data.submission + "</a>");
          }
        })

      });
    </script>
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" id="nav-second">
      <div class="container">
        <ul class="nav navbar-nav" id="nav-second-main">
          <li class="nav-li"><a class="nav-second-li" href="/" id="href-home"><b>Home</b></a></li>
          <li class="nav-li"><a class="nav-second-li" href="/dataset" id="href-description"><b>Dataset</b></a></li>
          <li class="nav-li"><a class="nav-second-li" href="/download" id="href-dataset"><b>Download</b></a></li>
          <li class="nav-li"><a class="nav-second-li" href="/challenge" id="href-challenge"><b>Challenge</b></a></li>
          <li class="nav-li active"><a class="nav-second-li" href="#" id="href-submission"><b>Submission</b></a></li>
          <li class="nav-li"><a class="nav-second-li" href="/leaderboard" id="href-leaderboard"><b>Leaderboard</b></a></li>
        </ul>
      </div>
    </nav>

    <nav class="navbar navbar-default navbar-fixed-top" id="nav-first">
      <div class="container">
        <div class="navbar-header">
          <img src="/static/img/logo.png" width="400px" id="logo">
        </div>
        <ul class="nav navbar-nav navbar-right" id="nav-first-main">
          <li class="nav-li dropdown">
            <a href="#" id="user" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><b>{{username}}</b></a>
            <ul class="dropdown-menu">
              <li><a href="#" id="editteam">Edit Team</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#" id="logout">Logout</a></li>
            </ul>
          </li>
          <li class="nav-li"><a href="mailto:social.media.prediction@gmail.com" id="href-contact"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> Contact</a></li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid" id="maintext">
      <div class="row" id="block1">
        <div class="container">
          <div class="col-xs-10 col-xs-offset-1">
            <h2 class="p-title"><b>Submission</b></h2>
            <p class="p-body no-team-display">
            You don't have a team now. Please create a team <a class="submit-edit" style="cursor: pointer;">here</a>.
            </p>
            <p class="p-body team-display">
            Submission system is closed.
            </p>
            <!-- <br>
            <p class="p-body team-display">
            You are on behalf of team <b id="submit-teamname"></b>. You can edit you team information <a class="submit-edit" style="cursor: pointer;">here</a>.
            </p>
            <form class="team-display" onsubmit="return false;">
              <button class="btn btn-primary btn-lg" id="submit-upload-btn">Upload File</button>
              <input type="file" id="submit-upload-real" style="display: none;">
              <br>
              <br>
              <div class="progress" id="submit-progress" style="display: none;">
                <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                </div>
              </div>
            </form> -->

            <h2 class="p-title team-display"><b>Latest Submission</b></h2>
            <p class="p-body team-display" id="latest-submission">You don't have submission yet</p>
          </div>
        </div>
      </div>


      <div class="row" id="block7">
        <div class="col-xs-10 col-xs-offset-1">
          <center><h5 style="color:white;">Copyright © 2019. SMP Challenge Organization Committee. All rights reserved.</h5></center>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-team">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">My Team</h4>
          </div>
          <div class="modal-body">
            <form id="team-form">
              <div class="form-group">
                <label for="team-name">Team Name</label>
                <input type="text" class="form-control team-input" id="team-name">
                <span id="team-name-warn" class="help-block"></span>
              </div>

              <div class="row">
                <div class="col-xs-2">
                  <br>
                  <label class="member-title">Captain</label>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label for="caption-name">Name</label>
                    <input type="text" class="form-control team-input" id="caption-name">
                    <span class="help-block"></span>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label for="caption-email">Email</label>
                    <input type="email" class="form-control team-input" id="caption-email">
                    <span class="help-block"></span>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="form-group">
                    <label for="caption-organization">Organization</label>
                    <input type="text" class="form-control team-input" id="caption-organization">
                    <span class="help-block"></span>
                  </div>
                </div>
                <!-- <div class="col-xs-1">
                  <button class="btn btn-danger"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>
                </div> -->
              </div>



            </form>
            <div class="row">
              <div class="col-xs-1 col-xs-offset-2">
                <br>
                <button class="btn btn-default" id="addmember"><span class="glyphicon glyphicon-plus"></span></button>
              </div>
            </div>

            <div class="row">
              <div class="col-xs-10 col-xs-offset-2">
                <p style="color: gray;">Your team can contain at most 8 members (including captain).</p>
              </div>
            </div>

          </div>
          <div class="modal-footer">
            <center><button type="button" class="btn btn-primary" id="save">Save</button></center>
          </div>
        </div>
      </div>
    </div>
  </body>
 </html>
